#!/usr/bin/env bash
set -euo pipefail

ROOT="$(cd "$(dirname "${BASH_SOURCE[0]}")/../.." && pwd)"
LOCAL_FALLBACK="$ROOT/tools/dev/yai-changelog-check.py"

# Local-first to keep changelog validation scoped to the current repo checkout.
if [[ -x "$LOCAL_FALLBACK" ]]; then
  exec "$LOCAL_FALLBACK" "$@"
fi

INFRA_ROOT_DEFAULT="$(cd "$ROOT/.." && pwd)/yai-infra"
INFRA_ROOT="${YAI_INFRA_ROOT:-$INFRA_ROOT_DEFAULT}"
TARGET="$INFRA_ROOT/tools/bin/yai-changelog-check"

if [[ -x "$TARGET" ]]; then
  YAI_CORE_ROOT="$ROOT" YAI_SPECS_ROOT="$ROOT/deps/yai-specs" exec "$TARGET" "$@"
fi

echo "Hard cutover: use yai-infra canonical tool for yai-changelog-check" >&2
echo "Missing target: $TARGET" >&2
exit 2
