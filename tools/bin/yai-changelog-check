#!/usr/bin/env bash
set -euo pipefail

ROOT="$(cd "$(dirname "${BASH_SOURCE[0]}")/../.." && pwd)"
INFRA_ROOT_DEFAULT="$(cd "$ROOT/.." && pwd)/yai-infra"
INFRA_ROOT="${YAI_INFRA_ROOT:-$INFRA_ROOT_DEFAULT}"
TARGET="$INFRA_ROOT/tools/bin/yai-changelog-check"

if [[ -x "$TARGET" ]]; then
  YAI_CORE_ROOT="$ROOT" YAI_SPECS_ROOT="$ROOT/deps/yai-law" exec "$TARGET" "$@"
fi

# CI compatibility: if yai-infra is not checked out, fall back to local validator.
LOCAL_FALLBACK="$ROOT/tools/dev/yai-changelog-check.py"
if [[ -x "$LOCAL_FALLBACK" ]]; then
  exec "$LOCAL_FALLBACK" "$@"
fi

echo "Hard cutover: use yai-infra canonical tool for yai-changelog-check" >&2
echo "Missing target: $TARGET" >&2
exit 2
